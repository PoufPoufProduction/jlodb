
jSav = jQuery;

$(window).ready(function() {

	$(window).resize();
});
$(window).load(function() {
    // Some epub readers overwrite jQuery with their own instance. WTF !!!
    setTimeout(function() {
        $ = jQuery = jSav; 
        
        var list = content.split(',');
        var state = "";
        for (var i in list) { state+="."; }
        // if ( localStorage && localStorage.getItem("jlodb") ) { state = localStorage.getItem("jlodb"); }
        for (var i=state.length; i<list.length; i++) { state+="."; }


        $("#rmenu").menu({
            list    : list,
            state   : state,
            onupdate: function($this, _state) {
                // if (localStorage) { localStorage.setItem("jlodb", _state); }
            },
            onclick : function($this, _args) {
                var args = $.extend({}, {activity:exercices[_args.id].activity, args:exercices[_args.id].args});
                args.args.locale = activities[exercices[_args.id].activity].locale;
                args.args.locale.label = activities[exercices[_args.id].activity].label;
                $("#activity").jlodb({
                    onstart:    function($this) { $(".rmenu").hide(); $this.parent().show(); },
                    onfinish:   function($this, _hide) { if (_hide) { $(".rmenu").show(); $this.parent().hide(); }
                                                         $("#score").score('hide'); },
                    onscore:    function($this, _ret) {
                                var isnext = false;
                                if (_ret.score>=2) { isnext = $("#rmenu").menu('score', _ret.score).menu('more'); }
                                $("#score #next").toggle(isnext);
                                $("#score").score('show',_ret.score);
                                return true; } },args);
            }
        });
    }, 1);
    
    $("#score").score({
        onreload:function($this) { $('#activity').jlodb('reload'); },
        onmenu:  function($this) { $('#activity').jlodb('close', true); },
        onnext:  function($this) { $('#activity').jlodb('close',false);$('#rmenu').menu('next'); } 
    });
    
});
]]></script>
    
    <style>
body        { font-size:6vw; background-color:#eee; background-image:inherit; }
body>div    { position:relative; left:0; width:16em; height:12em; background-color:white; display:inherit; }
.rmenu      { font-size:1em; width:100%; height:50%; }
#rcontent   { font-size:.5em; }
    </style>
    
</head>

<body><div>

