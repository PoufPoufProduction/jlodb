
jSav = jQuery;
$(window).load(function() {
    // Some epub readers overwrite jQuery with their own instance. WTF !!!
    setTimeout(function() {
        $ = jQuery = jSav; 
        
        var list = content.split(',');
        var state = "";
        for (var i in list) { state+="."; }
        // if ( localStorage && localStorage.getItem("jlodb") ) { state = localStorage.getItem("jlodb"); }
        for (var i=state.length; i<list.length; i++) { state+="."; }


        $("#rmenu").menu({
            list    : list,
            state   : state,
            onupdate: function($this, _state) {
                // if (localStorage) { localStorage.setItem("jlodb", _state); }
            },
            onclick : function($this, _args) {
                var args = $.extend({}, {activity:exercices[_args.id].activity, args:exercices[_args.id].args});
                args.args.locale = activities[exercices[_args.id].activity].locale;
                args.args.locale.label = activities[exercices[_args.id].activity].label;
                $(".rmenu").hide(); $("#launcher").show(); $("#activity").show();
                $("#launcher").jlodb({
                    onstart:    function($this) { },
                    onfinish:   function($this) { 
                        $(".rmenu").show(); $("#launcher").hide(); $("#activity").hide();
                        $("#score").removeClass().hide(); },
                    onscore:    function($this, _ret) {
                                var isnext = false;
                                if (_ret.score>=2) { isnext = $("#rmenu").menu('score', _ret.score).menu('more'); }
                                $("#score #next").toggle(isnext);
                                $("#score").attr("class","s"+_ret.score).show();
                                return true; } }, args );
            }
        });
    }, 1);
});

    </script>
    
    <style>
body        { font-size:6vw; background-color:#eee; background-image:inherit; }
body>div    { position:relative; left:0; width:16em; height:12em; background-color:white; display:inherit; }
.rmenu      { font-size:1em; width:100%; height:50%; }
#rcontent   { font-size:.5em; }
    </style>
    
</head>

<body><div>

    <div id="rcontent" class="rmenu">%content%</div>
    <div id="rmenu" class="rmenu theme2"></div>
        
    <div id="score"><div>
        <div class="content">
            <div class="value"></div><div class="stars"></div>
            <div class="icon" id="reload" ontouchstart="$('#launcher').jlodb('reload');event.preventDefault();"
                onclick="$('#launcher').jlodb('reload');" ><img src="res/img/default/icon/action_reload01.svg"/></div>
            <div class="icon" id="menu" ontouchstart="$('#launcher').jlodb('close',false);event.preventDefault();"
                onclick="$('#launcher').jlodb('close', false);" ><img src="res/img/default/icon/action_menu01.svg"/></div>
            <div class="icon" id="next"
                ontouchstart="$('#launcher').jlodb('close',false);$('#rmenu').menu('next');event.preventDefault();"
                onclick="$('#launcher').jlodb('close',false);$('#rmenu').menu('next');"><img src="res/img/default/icon/action_next01.svg"/></div>
        </div>
    </div></div>
        
    
    <div id="launcher">
        <div id="quit" ontouchstart="$('#launcher').jlodb('quit');event.preventDefault();"
                       onclick="$('#launcher').jlodb('quit');"><img src="res/img/default/icon/nw_quit01.svg"/></div>
        <div id="activity"></div>
    </div>

</div></body>
</html>
