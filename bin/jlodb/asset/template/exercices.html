<!DOCTYPE HTML>
<html xmlns='http://www.w3.org/1999/xhtml'>

  <head>
    <title>%title%</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="author" content="poufpoufproduction"/>
    <meta name="keywords" content="e-learning"/>
    <meta name="Copyright" content="CC0"/>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="js/jquery.svg.min.js"></script>
    <script type="text/javascript" src="js/jquery.jlodb.js"></script>
    <script type="text/javascript" src="js/jquery.jlodb.menu.js"></script>
    <link type="text/css" rel="stylesheet" href="css/jlodb.css" media="all" />
    <link type="text/css" rel="stylesheet" href="css/style.css" media="all" />
    
 <!-- ACTIVITIES JS CSS --> 

<script>

var data    = {};
var lang    = "";
var pageid  = "%pageid%";

jSav = jQuery; // EPUB READER OVERWRITING
$(window).ready(function() { $(window).resize(); });

$(window).load(function() {
    $.getJSON("data/lang.json", function(_lang) {
        lang=_lang[0];
        // GET LANG AND USER FROM LOCAL STORAGE OR COOKIES

    $.getJSON("data/"+lang+"/"+pageid+".json", function (_data) {
    
        $ = jQuery = jSav; // EPUB READER OVERWRITING
        data = _data;
      
        // LIST AND STATE
        var list = data.content.split(',');
        var state = ""; for (var i in list) { state+="."; }

        // if ( localStorage && localStorage.getItem("jlodb") ) { state = localStorage.getItem("jlodb"); }
        
        for (var i=state.length; i<list.length; i++) { state+="."; }

        $("#aamenu").menu({
            list    : list,
            state   : state,
            onupdate: function($this, _state) {
                // if (localStorage) { localStorage.setItem("jlodb", _state); }
            },
            onclick : function($this, _args) {
            
                var args = $.extend({}, {activity:data.exercices[_args.id].activity, args:data.exercices[_args.id].args});
                args.args.locale        = data.activities[data.exercices[_args.id].activity].locale;
                args.args.locale.label  = data.activities[data.exercices[_args.id].activity].label;
                
                $("#activity").jlodb({
                    onstart:    function($this) { $("#aapage").hide(); $this.parent().show(); },
                    onfinish:   function($this, _hide) { if (_hide) { $("#aapage").show(); $this.parent().hide(); }
                                                         $("#score").score('hide'); },
                    onscore:    function($this, _ret) {
                                var isnext = false;
                                if (_ret.score>=2) { isnext = $("#aamenu").menu('score', _ret.score).menu('more'); }
                                $("#score #next").toggle(isnext);
                                $("#score").score('show',_ret.score);
                                return true; } },args);
            }
        });
    });
    });
    
    $("#score").score({
        onreload:function($this) { $('#activity').jlodb('reload'); },
        onmenu:  function($this) { $('#activity').jlodb('close', true); },
        onnext:  function($this) { $('#activity').jlodb('close',false);$('#aamenu').menu('next'); } 
    });
    
});
</script>
    
</head>

<body><div>

    <div id="aapage">
        <div id="aacontent">
            <div id="aatemplate"></div>
            <div id="aanav">
                <div onclick="document.location.href='%prev%'"><img src="res/img/default/icon/action_prev01.svg" alt=""/></div>
                <div onclick="document.location.href='%menu%'"><img src="res/img/default/icon/action_menu01.svg" alt=""/></div>
                <div onclick="document.location.href='%next%'"><img src="res/img/default/icon/action_next01.svg" alt=""/></div>
            </div>
        </div>
        <div id="aamenu" class="theme2"></div>
    </div>
        
    <div id="score"></div>

    <div class="jlodb">
        <div id="quit" ontouchstart="$('#activity').jlodb('quit');event.preventDefault();"
                       onclick="$('#activity').jlodb('quit');"><img src="res/img/default/icon/nw_quit01.svg"/></div>
        <div id="activity"></div>
    </div>

</div></body>
</html>
